# IMusic 在线音乐播放系统说明文档

## 一、项目背景及意义

### 1.1 项目背景

随着互联网技术的快速发展和移动设备的普及，在线音乐服务已成为人们日常生活中不可或缺的一部分。传统的本地音乐播放器已无法满足用户随时随地听歌的需求，而现有的商业音乐平台往往存在版权限制、广告干扰等问题。

IMusic 项目旨在构建一个轻量级、易部署的个人音乐播放平台，让用户能够管理和播放自己的音乐收藏，同时提供现代化的 Web 界面和流畅的用户体验。

### 1.2 项目意义

1. **个人音乐管理**：为用户提供一个统一的平台来管理个人音乐收藏
2. **跨设备访问**：基于 Web 技术，用户可以在任何设备上通过浏览器访问音乐库
3. **技术学习价值**：项目采用前后端分离架构，涵盖现代 Web 开发的核心技术栈
4. **隐私保护**：用户可以自行部署，音乐数据完全由自己掌控

---

## 二、项目功能介绍

### 2.1 核心功能

| 功能模块 | 功能描述                                   |
| -------- | ------------------------------------------ |
| 用户管理 | 用户注册、登录、会话管理                   |
| 歌曲搜索 | 按歌曲名称或艺术家搜索音乐                 |
| 在线播放 | 支持音乐在线播放、暂停、进度控制、音量调节 |
| 收藏管理 | 添加/移除收藏歌曲                          |
| 歌单管理 | 创建和管理个人歌单                         |

### 2.2 功能特点

- **实时搜索**：快速搜索音乐库中的歌曲
- **播放控制**：支持上一曲/下一曲切换、进度拖拽、音量调节
- **持久登录**：支持记住登录状态，自动恢复会话
- **响应式设计**：适配不同屏幕尺寸的设备

---

## 三、技术栈及架构

### 3.1 技术栈概览

```
┌─────────────────────────────────────────────────────────────┐
│                        前端 (Frontend)                       │
├─────────────────────────────────────────────────────────────┤
│  React 19.2.0  │  Vite 7.1.10  │  CSS3  │  HTML5           │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ HTTP/REST API
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        后端 (Backend)                        │
├─────────────────────────────────────────────────────────────┤
│  Spring Boot 3.5.6  │  Spring Security  │  Spring Data JPA │
├─────────────────────────────────────────────────────────────┤
│                        Java 17                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ JPA/JDBC
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       数据库 (Database)                      │
├─────────────────────────────────────────────────────────────┤
│                    H2 Database (文件模式)                    │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 前端技术栈

| 技术  | 版本   | 用途                             |
| ----- | ------ | -------------------------------- |
| React | 19.2.0 | 前端 UI 框架，构建用户界面       |
| Vite  | 7.1.10 | 前端构建工具，提供快速的开发体验 |
| CSS3  | -      | 样式设计，实现响应式布局         |

### 3.3 后端技术栈

| 技术            | 版本  | 用途               |
| --------------- | ----- | ------------------ |
| Java            | 17    | 后端开发语言       |
| Spring Boot     | 3.5.6 | 后端应用框架       |
| Spring Data JPA | -     | 数据持久层框架     |
| Spring Security | -     | 安全认证框架       |
| H2 Database     | -     | 嵌入式数据库       |
| Maven           | -     | 项目构建和依赖管理 |

### 3.4 系统架构图

```
┌──────────────────────────────────────────────────────────────────┐
│                           客户端层                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │   搜索组件    │  │   播放器组件  │  │   收藏组件    │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │   登录组件    │  │   歌曲列表    │  │   Toast提示   │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│                          控制器层 (Controller)                    │
│  ┌────────────────────┐        ┌────────────────────┐           │
│  │   UserController   │        │   SongController   │           │
│  │  - 登录/注册        │        │  - 歌曲搜索         │           │
│  │  - 歌单管理         │        │  - 收藏管理         │           │
│  └────────────────────┘        └────────────────────┘           │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│                          服务层 (Service)                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐       │
│  │ UserService  │  │ SongService  │  │ SongListService  │       │
│  └──────────────┘  └──────────────┘  └──────────────────┘       │
│                    ┌──────────────────────┐                      │
│                    │ SongListItemsService │                      │
│                    └──────────────────────┘                      │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│                        数据访问层 (Repository)                    │
│  ┌────────────────┐  ┌────────────────┐  ┌──────────────────┐   │
│  │ UserRepository │  │ SongRepository │  │SongListRepository│   │
│  └────────────────┘  └────────────────┘  └──────────────────┘   │
│                    ┌────────────────────────┐                    │
│                    │ SongListItemsRepository│                    │
│                    └────────────────────────┘                    │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│                          数据库层                                 │
│                      H2 Database (File)                          │
└──────────────────────────────────────────────────────────────────┘
```

---

## 四、数据库设计

### 4.1 数据库选型

项目采用 **H2 Database** 作为数据存储方案：

- 轻量级嵌入式数据库，无需独立安装
- 支持文件持久化存储
- 提供 Web 控制台便于调试
- 兼容标准 SQL 语法

### 4.2 数据表设计

#### 4.2.1 用户表 (users)

| 字段名   | 数据类型 | 约束                        | 说明   |
| -------- | -------- | --------------------------- | ------ |
| id       | BIGINT   | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| username | VARCHAR  | NOT NULL, UNIQUE            | 用户名 |
| password | VARCHAR  | NOT NULL                    | 密码   |

#### 4.2.2 歌曲表 (songs)

| 字段名          | 数据类型 | 约束                        | 说明         |
| --------------- | -------- | --------------------------- | ------------ |
| id              | BIGINT   | PRIMARY KEY, AUTO_INCREMENT | 歌曲ID       |
| file_path       | VARCHAR  | NOT NULL                    | 音频文件路径 |
| cover_file_path | VARCHAR  | NOT NULL                    | 封面图片路径 |
| title           | VARCHAR  | NOT NULL                    | 歌曲标题     |
| artist          | VARCHAR  | NOT NULL                    | 歌手         |
| album           | VARCHAR  | NOT NULL                    | 专辑名称     |
| album_artist    | VARCHAR  | NOT NULL                    | 专辑艺术家   |
| year            | VARCHAR  | NOT NULL                    | 发行年份     |
| genre           | VARCHAR  | NOT NULL                    | 音乐流派     |
| track_number    | VARCHAR  | NOT NULL                    | 曲目编号     |
| bitrate         | VARCHAR  | NOT NULL                    | 比特率       |
| duration        | VARCHAR  | NOT NULL                    | 时长         |

#### 4.2.3 歌单表 (song_list)

| 字段名    | 数据类型 | 约束                        | 说明     |
| --------- | -------- | --------------------------- | -------- |
| id        | BIGINT   | PRIMARY KEY, AUTO_INCREMENT | 歌单ID   |
| list_name | VARCHAR  | NOT NULL                    | 歌单名称 |
| username  | VARCHAR  | NOT NULL                    | 创建用户 |

#### 4.2.4 歌单项目表 (song_list_items)

| 字段名       | 数据类型 | 约束                        | 说明       |
| ------------ | -------- | --------------------------- | ---------- |
| id           | BIGINT   | PRIMARY KEY, AUTO_INCREMENT | 记录ID     |
| title        | VARCHAR  | NOT NULL                    | 歌曲标题   |
| album_artist | VARCHAR  | NOT NULL                    | 专辑艺术家 |
| album        | VARCHAR  | NOT NULL                    | 专辑名称   |
| username     | VARCHAR  | NOT NULL                    | 所属用户   |
| list_name    | VARCHAR  | NOT NULL                    | 所属歌单   |

### 4.3 ER 图

```
┌─────────────┐       ┌─────────────────┐       ┌─────────────┐
│    User     │       │   SongListItems │       │    Song     │
├─────────────┤       ├─────────────────┤       ├─────────────┤
│ id (PK)     │       │ id (PK)         │       │ id (PK)     │
│ username    │◄──────│ username        │       │ file_path   │
│ password    │       │ list_name       │       │ cover_path  │
└─────────────┘       │ title           │──────►│ title       │
      │               │ album_artist    │       │ artist      │
      │               │ album           │       │ album       │
      │               └─────────────────┘       │ album_artist│
      │                                         │ year        │
      ▼                                         │ genre       │
┌─────────────┐                                 │ track_number│
│  SongList   │                                 │ bitrate     │
├─────────────┤                                 │ duration    │
│ id (PK)     │                                 └─────────────┘
│ list_name   │
│ username    │
└─────────────┘
```

---

## 五、关键技术及解决方案

### 5.1 前后端分离架构

**技术难点**：前后端分离部署时的跨域问题

**解决方案**：

- 后端配置 CORS 跨域支持（WebConfig.java）
- 配置 Cookie 的 SameSite 属性为 None
- 设置 Cookie 的 Secure 属性确保 HTTPS 传输

```java
// WebConfig.java - CORS 配置
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("*")
                .allowedMethods("GET", "POST", "PUT", "DELETE")
                .allowCredentials(true);
    }
}
```

### 5.2 用户会话管理

**技术难点**：HTTP 无状态协议下的用户身份保持

**解决方案**：

- 使用 Spring Session 管理用户会话
- 前端使用 LocalStorage 存储登录凭证
- 页面加载时自动恢复登录状态

```javascript
// 前端自动恢复登录
useEffect(() => {
  const restoreLogin = async () => {
    const username = localStorage.getItem('username')
    const password = localStorage.getItem('password')
    if (isLoggedIn === 'true' && username && password) {
      // 调用登录接口恢复 session
      await fetch(`${BASE_URL}/api/user/login/password`, {...})
    }
  }
  restoreLogin()
}, [])
```

### 5.3 音频播放控制

**技术难点**：Web 端音频播放的精确控制

**解决方案**：

- 使用 HTML5 Audio API
- 通过 React useRef 获取音频元素引用
- 实现播放/暂停、进度控制、音量调节等功能

```javascript
// 音频播放控制
const audioRef = useRef(null)

const togglePlay = () => {
  if (audioRef.current) {
    if (isPlaying) {
      audioRef.current.pause()
    } else {
      audioRef.current.play()
    }
    setIsPlaying(!isPlaying)
  }
}
```

### 5.4 歌曲搜索功能

**技术难点**：模糊搜索和排序

**解决方案**：

- 后端使用 JPA 自定义查询
- 支持按歌曲标题或艺术家名称搜索
- 结果按相关性排序

### 5.5 安全认证

**技术难点**：API 接口的安全访问控制

**解决方案**：

- 使用 Spring Security 框架
- Session 级别的身份验证
- 敏感操作需要验证登录状态

---

## 六、技术点及开发工作

### 6.1 前端开发工作

| 组件/模块          | 功能描述     | 技术要点           |
| ------------------ | ------------ | ------------------ |
| App.jsx            | 主应用组件   | 状态管理、路由控制 |
| SearchBar.jsx      | 搜索栏组件   | 用户输入处理       |
| SongList.jsx       | 歌曲列表组件 | 列表渲染、事件处理 |
| Player.jsx         | 播放器组件   | 音频控制、进度条   |
| Favorites.jsx      | 收藏列表组件 | 收藏管理           |
| Login.jsx          | 登录组件     | 表单验证、API调用  |
| Toast.jsx          | 提示组件     | 消息通知           |
| LoadingOverlay.jsx | 加载遮罩     | 加载状态展示       |

### 6.2 后端开发工作

| 模块       | 类名                    | 功能描述                 |
| ---------- | ----------------------- | ------------------------ |
| Controller | UserController          | 用户登录、注册、歌单管理 |
| Controller | SongController          | 歌曲搜索、播放、收藏管理 |
| Service    | UserService             | 用户业务逻辑             |
| Service    | SongService             | 歌曲业务逻辑             |
| Service    | SongListService         | 歌单业务逻辑             |
| Service    | SongListItemsService    | 歌单项目业务逻辑         |
| Repository | UserRepository          | 用户数据访问             |
| Repository | SongRepository          | 歌曲数据访问             |
| Repository | SongListRepository      | 歌单数据访问             |
| Repository | SongListItemsRepository | 歌单项目数据访问         |
| Entity     | User                    | 用户实体类               |
| Entity     | Song                    | 歌曲实体类               |
| Entity     | SongList                | 歌单实体类               |
| Entity     | SongListItems           | 歌单项目实体类           |
| Config     | SecurityConfig          | 安全配置                 |
| Config     | WebConfig               | Web配置（CORS等）        |
| DTO        | ApiResponse             | 统一响应格式             |
| DTO        | LoginRequest            | 登录请求                 |
| DTO        | SongRequest             | 歌曲请求                 |
| DTO        | SongResponse            | 歌曲响应                 |

### 6.3 API 接口列表

| 接口路径                      | 方法 | 功能描述         |
| ----------------------------- | ---- | ---------------- |
| /api/user/login/password      | POST | 用户登录         |
| /api/user/register            | POST | 用户注册         |
| /api/user/songLists/show      | POST | 获取用户歌单     |
| /api/user/songLists/add       | POST | 创建歌单         |
| /api/song/search/all          | POST | 搜索歌曲         |
| /api/song/play                | POST | 播放歌曲         |
| /api/song/search/insonglist   | POST | 查询歌单中的歌曲 |
| /api/song/add/tosonglist      | POST | 添加歌曲到歌单   |
| /api/song/delete/fromsonglist | POST | 从歌单删除歌曲   |

---

## 七、项目目录结构

```
imusic/
├── imusic-backend/                    # 后端项目
│   ├── pom.xml                        # Maven 配置文件
│   ├── src/
│   │   └── main/
│   │       ├── java/xyz/mywebs/imusic/
│   │       │   ├── ImusicApplication.java    # 启动类
│   │       │   ├── Config/                   # 配置类
│   │       │   │   ├── SecurityConfig.java
│   │       │   │   └── WebConfig.java
│   │       │   ├── Controller/               # 控制器
│   │       │   │   ├── UserController.java
│   │       │   │   └── SongController.java
│   │       │   ├── Service/                  # 服务层
│   │       │   │   ├── UserService.java
│   │       │   │   ├── SongService.java
│   │       │   │   ├── SongListService.java
│   │       │   │   └── SongListItemsService.java
│   │       │   ├── Repository/               # 数据访问层
│   │       │   │   ├── UserRepository.java
│   │       │   │   ├── SongRepository.java
│   │       │   │   ├── SongListRepository.java
│   │       │   │   └── SongListItemsRepository.java
│   │       │   ├── Entity/                   # 实体类
│   │       │   │   ├── User.java
│   │       │   │   ├── Song.java
│   │       │   │   ├── SongList.java
│   │       │   │   └── SongListItems.java
│   │       │   └── Dto/                      # 数据传输对象
│   │       │       ├── ApiResponse.java
│   │       │       ├── LoginRequest.java
│   │       │       ├── SongRequest.java
│   │       │       └── SongResponse.java
│   │       └── resources/
│   │           └── application.properties    # 应用配置
│   └── data/                          # H2数据库文件
│
└── imusic-frontend/                   # 前端项目
    ├── package.json                   # npm 配置文件
    ├── vite.config.js                 # Vite 配置
    ├── index.html                     # 入口 HTML
    └── src/
        ├── main.jsx                   # 应用入口
        ├── App.jsx                    # 主组件
        ├── App.css                    # 主样式
        ├── config.js                  # 配置文件
        ├── index.css                  # 全局样式
        └── components/                # 组件目录
            ├── SearchBar.jsx          # 搜索栏
            ├── SearchBar.css
            ├── SongList.jsx           # 歌曲列表
            ├── SongList.css
            ├── Player.jsx             # 播放器
            ├── Player.css
            ├── Favorites.jsx          # 收藏列表
            ├── Favorites.css
            ├── Login.jsx              # 登录组件
            ├── Login.css
            ├── Toast.jsx              # 提示组件
            ├── Toast.css
            ├── LoadingOverlay.jsx     # 加载遮罩
            └── LoadingOverlay.css
```

---

## 八、部署说明

### 8.1 环境要求

- **后端**：JDK 17+、Maven 3.6+
- **前端**：Node.js 18+、npm

### 8.2 后端启动

```bash
cd imusic-backend
mvn spring-boot:run
```

后端服务将在 `http://localhost:8080` 启动

### 8.3 前端启动

```bash
cd imusic-frontend
npm install
npm run dev
```

前端开发服务器将启动，访问对应地址即可使用

---

## 九、源代码

**GitHub 仓库地址**：[https://github.com/MagicalFlames/i_music](https://github.com/MagicalFlames/i_music)

---

## 十、总结

IMusic 是一个完整的前后端分离的在线音乐播放系统，采用了现代化的技术栈，具有以下特点：

1. **架构清晰**：采用标准的三层架构（Controller-Service-Repository）
2. **技术先进**：使用 React 19 + Spring Boot 3 等最新技术
3. **功能完善**：涵盖用户管理、歌曲搜索、在线播放、收藏管理等核心功能
4. **易于部署**：使用嵌入式数据库，部署简单
